# 要件定義書

## 概要

この機能は、個人投資家向けに毎日10分間のマーケットニュース番組を完全自動で生成・配信するシステムを実装します。ニュース記事をスクレイピングし、Gemini AIで要約・台本生成を行い、高品質なTTS音声を合成して、Podcast RSSとLINEメッセージングで同時配信します。全プロセスはGitHub Actionsにより毎朝5:00 JSTに自動実行されます。

## 要件

### 要件1

**ユーザーストーリー:** 個人投資家として、毎日10分間のマーケットニュースポッドキャストを自動生成・配信してもらい、効率的に市場動向を把握したい。

#### 受入基準

1. システムが毎日05:00 JSTに実行される時、システムはマーケットニュースコンテンツを含む1つのMP3ファイルを生成すること
2. 音声コンテンツを生成する時、システムは再生時間を9.5-10分間に収めること
3. ポッドキャストを作成する時、システムはファイルサイズを15MB以下に制限すること
4. コンテンツが準備完了した時、システムはPodcast RSSとLINEチャンネルに同時配信すること

### 要件2

**ユーザーストーリー:** コンテンツ消費者として、明確なセグメント構成とプロフェッショナルな音質のポッドキャストを聞き、市場情報を理解しやすくしたい。

#### 受入基準

1. ポッドキャストコンテンツを生成する時、システムは収集したマーケットニュースを重要度順に整理し、自然な対話形式で構成すること
2. 音声を作成する時、システムはオープニング、セグメント移行、クロージングの固定フレーズを含めること
3. 音声を処理する時、システムは音量を-16 LUFS、ピークを-1 dBFSに正規化すること
4. 音声を組み立てる時、システムはCC-BYライセンスのBGMとジングルをシームレスに統合すること
5. CC-BYコンテンツを使用する時、システムはRSSとLINEメッセージにクレジットを自動挿入すること

### 要件3

**ユーザーストーリー:** システム管理者として、コンテンツ生成を費用対効果良く信頼性高く運用し、予算制約内で持続可能なサービスを提供したい。

#### 受入基準

1. TTSサービスを使用する時、システムは月額コストを10米ドル以下に抑えること
2. システムが動作する時、システムは安定した動作を維持すること
3. 台本を生成する時、システムは最適なTTS処理のため2,400-2,800文字を生成すること

### 要件4

**ユーザーストーリー:** コンテンツ作成者として、著作権を尊重しながらニュースコンテンツを自動収集・処理し、法的リスクなく価値ある情報を提供したい。

#### 受入基準

1. ニュースをスクレイピングする時、システムはBeautifulSoupを使用してRSSフィードとHTMLソースからコンテンツを収集すること
2. 記事を処理する時、システムは要約に既存のGemini Flash（gemini-2.0-flash-lite-001）を使用し、対話台本生成にはより高性能なGemini 2.5 Proを使用すること
3. ソースコンテンツを含める時、システムは著作権問題を回避するため記事タイトルと要約のみを使用すること
4. 重複コンテンツを検出する時、システムはハッシュベースの重複排除を使用すること
5. 対話を作成する時、システムはコンテンツを2人の話者による自然な会話形式にフォーマットすること

### 要件5

**ユーザーストーリー:** ポッドキャストリスナーとして、自然な音声による高品質な音声を聞き、コンテンツを魅力的で聞きやすくしたい。

#### 受入基準

1. 音声を生成する時、システムは2つの異なる音声のためにスピーカーIDタグ付きGemini TTSを使用すること
2. 対話を作成する時、システムは話者間を自然に交互させること
3. 音声を処理する時、システムはBGMとジングルをシームレスに統合すること
4. 発音を管理する時、システムは修正のためYAMLベースの発音辞書を使用すること

### 要件6

**ユーザーストーリー:** サービス運営者として、複数チャンネルへの自動配信により、ユーザーが好みのプラットフォームでコンテンツにアクセスできるようにしたい。

#### 受入基準

1. コンテンツが準備完了した時、システムはfeedgenを使用してポッドキャストRSSフィードを生成すること
2. RSSを公開する時、システムはGitHub Pagesでホストすること
3. LINEで配信する時、システムはLINE Messaging APIを使用してブロードキャストすること
4. GitHub Pagesの帯域幅が月50GBを超える時、システムはS3ストレージにリダイレクトすること
5. コンテンツが公開される時、システムは両方のチャンネルを同時に更新すること

### 要件7

**ユーザーストーリー:** システム保守担当者として、監視と分析機能により、パフォーマンスを追跡しサービスを最適化したい。

#### 受入基準

1. システムが動作する時、システムはTTS文字数とコストメトリクスを追跡すること
2. 発音辞書が更新される時、システムはPRマージで自動デプロイすること
3. 障害が発生した時、システムは適切なエラーログを出力すること

### 要件8

**ユーザーストーリー:** 開発者として、保守可能で拡張可能なシステムにより、新機能やチャンネルを簡単に追加できるようにしたい。

#### 受入基準

1. コードを構造化する時、システムは関心事を別々のモジュール（crawler, summarizer, script_gen, tts, audio_post, publisher）に分離すること
2. 設定を管理する時、システムはアプリ設定と発音辞書にYAMLファイルを使用すること
3. アセットを保存する時、システムはジングルと音声ファイルを専用ディレクトリに整理すること
4. CI/CDを実装する時、システムは自動化にGitHub Actionsワークフローを使用すること
5. アーキテクチャを設計する時、システムは将来の多言語・多チャンネル展開をサポートすること