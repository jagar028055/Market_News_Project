# Market News Aggregator

## 1. 概要 (Overview)

このプロジェクトは、複数の金融・経済ニュースサイト（現在はロイター、ブルームバーグに対応）から最新ニュースを自動的に収集し、指定したGoogle Driveフォルダに単一のGoogleドキュメントとして出力するツールです。

日々の情報収集を効率化し、関心のある市場ニュースをまとめたカスタムレポートを自動で生成することを目的としています。

## 2. 主な機能 (Features)

- **複数サイトからのニュース収集**:
  - ロイター（日本語版）
  - ブルームバーグ（日本語版）
- **柔軟なフィルタリング**:
  - 収集する記事の期間（例: 過去24時間以内）を指定可能。
  - キーワード、カテゴリ、除外ワードを設定し、必要な情報だけを抽出。
- **Googleドキュメントへの自動出力**:
  - 収集した全記事を、タイトル、URL、発行日時、本文（抜粋）と共に1つのGoogleドキュメントに整理して出力。
  - ファイル名は実行日時に基づいて自動で命名 (`YYYYMMDD_HHMM_Market_News_Summary`)。
- **簡単な実行と設定**:
  - `main.py` を実行するだけで、一連の処理が自動で開始されます。
  - 検索条件や設定は `config.py` ファイルで簡単にカスタマイズ可能。

## 3. セットアップ手順 (Setup)

本ツールを実行するには、いくつかの事前準備が必要です。

### Step 1: リポジトリのクローンとライブラリのインストール

まず、プロジェクトファイルをローカル環境に準備します。

```bash
# 1. プロジェクトをクローン
git clone <repository_url>
cd Market_News

# 2. 必要なライブラリをインストール
pip install -r requirements.txt
```

### Step 2: Google Cloud Platform (GCP) でのAPI設定

本ツールはGoogle Drive APIとGoogle Docs APIを利用します。以下の手順でAPIを有効化し、認証情報を取得してください。

1.  **Google Cloud Consoleにアクセス**し、プロジェクトを選択または新規作成します。
2.  **APIライブラリに移動**:
    -   ナビゲーションメニューから `[APIとサービス]` > `[ライブラリ]` を選択します。
    -   以下の2つのAPIを検索し、それぞれ**【有効にする】**ボタンをクリックします。
        -   **Google Drive API**
        -   **Google Docs API**
3.  **OAuthクライアントIDの作成**:
    -   `[APIとサービス]` > `[認証情報]` に移動します。
    -   `[+ 認証情報を作成]` > `[OAuth クライアント ID]` を選択します。
    -   アプリケーションの種類で **【デスクトップアプリ】** を必ず選択してください。
    -   作成後、クライアントIDの右側にある**ダウンロードアイコン（JSONをダウンロード）**をクリックします。
    -   ダウンロードしたJSONファイルを、このプロジェクトのルートディレクトリに `anscombe.json` という名前で保存します。

### Step 3: 出力先Google Driveフォルダの指定

収集したニュースを出力するGoogle Driveフォルダを準備します。

1.  Google Driveで、出力先としたいフォルダを開きます。
2.  ブラウザのアドレスバーに表示されているURLの末尾部分が**フォルダID**です。これをコピーします。
    -   例: `https://drive.google.com/drive/folders/1aBcDeFgHiJkLmNoPqRsTuVwXyZ123456`
    -   この場合のフォルダIDは `1aBcDeFgHiJkLmNoPqRsTuVwXyZ123456` です。
3.  プロジェクトのルートディレクトリに `.env` という名前のファイルを新規作成し、以下の内容を記述します。コピーしたフォルダIDを貼り付けてください。

    ```
    GOOGLE_DRIVE_OUTPUT_FOLDER_ID="ここにあなたのGoogle DriveフォルダIDを貼り付け"
    ```

## 4. 実行方法 (Usage)

すべての設定が完了したら、以下のコマンドでスクリプトを実行します。

```bash
python main.py
```

### 初回実行時の認証

初回実行時には、ブラウザが自動的に開き、Googleアカウントへのアクセス許可を求める認証画面が表示されます。

-   **「Googleによる確認が完了していません」** という画面が表示される場合がありますが、これは個人開発のアプリでは正常な表示です。`[詳細]` > `[（アプリ名）に移動]` をクリックして進んでください。
-   表示される権限（Google DriveとDocsの操作）を許可してください。

認証が成功すると、`token.json` というファイルが生成され、次回以降は自動で認証が行われます。

## 5. 設定のカスタマイズ (Configuration)

`config.py` ファイルを編集することで、収集するニュースの条件を自由に変更できます。

-   `HOURS_LIMIT`: 記事を収集する時間範囲（時間単位）
-   `REUTERS_CONFIG`:
    -   `query`: 検索キーワード。`OR` で複数指定可能。
    -   `target_categories`: 収集対象とする記事カテゴリ。
    -   `exclude_keywords`: タイトルに含まれている場合、収集から除外するキーワード。
-   `BLOOMBERG_CONFIG`:
    -   `exclude_keywords`: 除外キーワード。

## 6. 注意事項 (Notes)

-   本ツールはWebスクレイピング技術を利用しています。ニュースサイトのHTML構造が変更された場合、正常に動作しなくなる可能性があります。
-   GCPのOAuth同意画面が「テスト中」の場合、認証できるユーザーが制限されます。もし `access_denied` エラーが出る場合は、GCPコンソールでアプリを「本番環境」に公開してください。
